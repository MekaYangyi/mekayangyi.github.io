<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>[读书笔记] sicp 第三章 模块化 对象和状态 | 鉴心</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="有效的程序综合还需要一些组织原则，它们能够指导我们系统化地完成系统的整体设计。特别的需要一些能够帮助我们构造起模块化的大型系统策略，也就是说，使这些系统能够“自然地”划分为一些具有内聚力的部分，使这些部分可以分别进行开发和维护。有一种非常强有力的设计策略，特别适合用于构造那类模拟真实物理系统的程序，那就是基于被模拟程序的结构去设计程序的结构。那么有关的物理系统里的每一个对象，我们构造起一个与之对象">
<meta property="og:type" content="article">
<meta property="og:title" content="[读书笔记] sicp 第三章 模块化 对象和状态">
<meta property="og:url" content="http://yoursite.com/child/blog/2016/09/读书笔记-sicp-第三章-模块化-对象和状态.html">
<meta property="og:site_name" content="鉴心">
<meta property="og:description" content="有效的程序综合还需要一些组织原则，它们能够指导我们系统化地完成系统的整体设计。特别的需要一些能够帮助我们构造起模块化的大型系统策略，也就是说，使这些系统能够“自然地”划分为一些具有内聚力的部分，使这些部分可以分别进行开发和维护。有一种非常强有力的设计策略，特别适合用于构造那类模拟真实物理系统的程序，那就是基于被模拟程序的结构去设计程序的结构。那么有关的物理系统里的每一个对象，我们构造起一个与之对象">
<meta property="og:updated_time" content="2016-10-16T06:35:48.571Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[读书笔记] sicp 第三章 模块化 对象和状态">
<meta name="twitter:description" content="有效的程序综合还需要一些组织原则，它们能够指导我们系统化地完成系统的整体设计。特别的需要一些能够帮助我们构造起模块化的大型系统策略，也就是说，使这些系统能够“自然地”划分为一些具有内聚力的部分，使这些部分可以分别进行开发和维护。有一种非常强有力的设计策略，特别适合用于构造那类模拟真实物理系统的程序，那就是基于被模拟程序的结构去设计程序的结构。那么有关的物理系统里的每一个对象，我们构造起一个与之对象">
  
    <link rel="alternate" href="/atom.xml" title="鉴心" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">鉴心</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com/child"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-读书笔记-sicp-第三章-模块化-对象和状态" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/09/读书笔记-sicp-第三章-模块化-对象和状态.html" class="article-date">
  <time datetime="2016-09-10T00:33:32.000Z" itemprop="datePublished">2016-09-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/读书笔记/">读书笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      [读书笔记] sicp 第三章 模块化 对象和状态
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有效的程序综合还需要一些组织原则，它们能够指导我们系统化地完成系统的整体设计。特别的需要一些能够帮助我们构造起模块化的大型系统策略，也就是说，使这些系统能够“自然地”划分为一些具有内聚力的部分，使这些部分可以分别进行开发和维护。<br>有一种非常强有力的设计策略，特别适合用于构造那类模拟真实物理系统的程序，那就是基于被模拟程序的结构去设计程序的结构。那么有关的物理系统里的每一个对象，我们构造起一个与之对象的计算对象；对该系统里的每种活动，我们在自己的计算系统里顶一种符号操作。采用这一策略时的希望是，在需要针对系统中的新对象或者新活动扩充对应的计算模型时候，我们能够不必对程序的组织方面做得很成功，那么在需要添加新特城或者排除旧东西里的错误时候，就只需要在系统里的一些小局部中工作。<br>本章研究两种特点鲜明的策略。第一种策略将注意力集中在对象上，将大型系统看成一大批对象，它们的行为可能随着时间的进展而不断的变化。另一种组织策略将注意力集中在流过的系统的信息流上，非常像电子工程师观察一个信号处理系统。<br>对于对象途径而言，我们必须关注计算对象可以怎样变化而又同时保持其标识。这将迫使我们抛弃老的计算的代换模型，转向更机械式的，理论上也更不同意把握的计算的环境模型。在处理对象、变化和标识时，各种困难的基本根源在于我们需要在这一计算模型中与时间搏斗。如果允许程序并发指向的可能性，事情会变得更困难许多。流方式特别能用于松解在我们模型中对时间的模拟与计算机求值过程中的各种时间发生的顺序。我们将通过一种称为延时求值的技术做到这一点。</p>
<h1 id="赋值和局部状态"><a href="#赋值和局部状态" class="headerlink" title="赋值和局部状态"></a>赋值和局部状态</h1><p>一个由许多对象组成的系统里，其中的这些对象极少会是完全独立的。每个对象都可能通过交互作用，影响其他对象的状态，所谓交互就是建立起一个对象的状态变量与其他对象的状态变量之间的联系。确实如果一个系统中的状态变量可以分组，形成一些内部紧密结合的子系统，每个子系统与其他子系统之间只存在松散的练习，此时将这个系统看作是由一些独立对象组成的观点就会特别有用。<br>对于一个系统的这种观点，有可能成为组织这一系统的计算模型的有力框架。要使这样的一个模型成为模块化的，就要求它能够分解为一批计算对象，使它们能够模拟系统里的实际对象。每个计算对象必须有它自己的一些局部状态变量，用于描述实际对象的状态。对于被模拟系统里的对象的状态是随着时间的变化的，与它们对象的计算对象的状态也必须变化。<br><a id="more"></a></p>
<h2 id="局部状态变量"><a href="#局部状态变量" class="headerlink" title="局部状态变量"></a>局部状态变量</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">(<span class="name">set!</span> &lt;name&gt; &lt;new-value&gt;)<span class="comment">;设置值</span></div><div class="line">(<span class="name">begin</span> &lt;exp1&gt; &lt;exp2&gt;)<span class="comment">;顺序求值</span></div><div class="line"></div><div class="line">(<span class="name">define</span> balance <span class="number">100</span>)</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">withdraw</span> amount)</div><div class="line">  (<span class="name">if</span> (<span class="name">&gt;=</span> balance amount)</div><div class="line">      (<span class="name">begin</span> (<span class="name">set!</span> balance (<span class="name">-</span> balance amount))</div><div class="line">             balance)</div><div class="line">      <span class="string">"Insufficient funds"</span>))</div></pre></td></tr></table></figure>
<p>上面使用了全局变量<br>下面使用局部变量</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> new-withdraw</div><div class="line">  (<span class="name">let</span> ((<span class="name">balance</span> <span class="number">100</span>))</div><div class="line">    (<span class="name">lambda</span> (<span class="name">amount</span>)</div><div class="line">      (<span class="name">if</span> (<span class="name">&gt;=</span> balance amount)</div><div class="line">          (<span class="name">begin</span> (<span class="name">set!</span> balance (<span class="name">-</span> balance amount))</div><div class="line">                 balance)</div><div class="line">          <span class="string">"Insufficient funds"</span>))))</div></pre></td></tr></table></figure>
<p>构建一个提款机<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> (<span class="name">make-withdraw</span> balance)</div><div class="line">  (<span class="name">lambda</span> (<span class="name">amount</span>)</div><div class="line">    (<span class="name">if</span> (<span class="name">&gt;=</span> balance amount)</div><div class="line">        (<span class="name">begin</span> (<span class="name">set!</span> balance (<span class="name">-</span> balance amount))</div><div class="line">               balance)</div><div class="line">        <span class="string">"Insufficient funds"</span>)))</div></pre></td></tr></table></figure></p>
<p>创建一个账户<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> (<span class="name">make-withdraw</span> balance)</div><div class="line">  (<span class="name">define</span> (<span class="name">withdraw</span> amount)</div><div class="line">    (<span class="name">if</span> (<span class="name">&gt;=</span> balance amount)</div><div class="line">        (<span class="name">begin</span> (<span class="name">set!</span> balance (<span class="name">-</span> balance amount))</div><div class="line">               balance)</div><div class="line">        <span class="string">"Insufficient funds"</span>))</div><div class="line">  (<span class="name">define</span> (<span class="name">deposit</span> amount)</div><div class="line">    (<span class="name">set!</span> balance (<span class="name">+</span> balance amount))</div><div class="line">    balance)</div><div class="line">  (<span class="name">define</span> (<span class="name">dispatch</span> m)</div><div class="line">    (<span class="name">cond</span> ((<span class="name">eq</span>? m 'withdraw) withdraw)</div><div class="line">          ((<span class="name">eq</span>? m 'deposit) deposit)</div><div class="line">          (<span class="name">else</span> (<span class="name">error</span> <span class="string">"Unknoew request --MAKE-ACCOUNT"</span></div><div class="line">                       m))))</div><div class="line">  dispatch)</div></pre></td></tr></table></figure></p>
<h2 id="引进赋值带来的收益"><a href="#引进赋值带来的收益" class="headerlink" title="引进赋值带来的收益"></a>引进赋值带来的收益</h2><p>能够简化一部分需要变量状态的过程。</p>
<h2 id="引进赋值的代价"><a href="#引进赋值的代价" class="headerlink" title="引进赋值的代价"></a>引进赋值的代价</h2><p>相比函数是编程，输入什么结果就是什么。显然引进赋值让程序变得更复杂。<br>需要存在一个位置存储变量。</p>
<h3 id="命令式程序设计的缺陷"><a href="#命令式程序设计的缺陷" class="headerlink" title="命令式程序设计的缺陷"></a>命令式程序设计的缺陷</h3><p>与函数式程序设计相对，广泛采用的赋值程序设计被称为命令是程序设计。<br>求值顺序需要保证。</p>
<h1 id="求值的环境模型"><a href="#求值的环境模型" class="headerlink" title="求值的环境模型"></a>求值的环境模型</h1><p>类似于C++的区域。<br>过程也是对象。<br>调用过程就会产生新的上下文环境，过程内的是过程内的环境。过程外全局环境等。</p>
<p>过程应用的环境模型两条规则：</p>
<ol>
<li>将一个过程对象应用于一集实际参数，将构造出一个新框架，其中将过程的形式参数约束到调用时的实际参数，而后在构造起的这一新环境的上下文中求</li>
<li>相对于一个给定的环境求值一个lambda表达式，将创建其一个过程对象，这个过程对象是一个序对，由该lambda表达式的征文和一个指向环境的指针组成，这一指针指向的就是创建这个过程对象时候的环境。</li>
</ol>
<h2 id="简单过程的应用"><a href="#简单过程的应用" class="headerlink" title="简单过程的应用"></a>简单过程的应用</h2><h2 id="将框架看做局部状态的展台"><a href="#将框架看做局部状态的展台" class="headerlink" title="将框架看做局部状态的展台"></a>将框架看做局部状态的展台</h2><h2 id="内部定义"><a href="#内部定义" class="headerlink" title="内部定义"></a>内部定义</h2><ol>
<li>局部过程的名字不会与包容它们的过程之外的名字互相干扰，这是因为这些局部过程名 都是该过程运行时创建的框架里约束的，而不是在全局环境里约束的。</li>
<li>局部过程只需将包含着它们的过程的形参作为自由变量，就可以访问该过程的实际参数，这是因为对于局部过程体的求值所在的环境是外围过程求值所在的环境的下属。</li>
</ol>
<h1 id="用变动的数据做模拟"><a href="#用变动的数据做模拟" class="headerlink" title="用变动的数据做模拟"></a>用变动的数据做模拟</h1><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> (<span class="name">append!</span> x y)</div><div class="line">  (<span class="name">set-cdr!</span> (<span class="name">last-pair</span> x) y)</div><div class="line">  x)</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">last-pair</span> x)</div><div class="line">  (<span class="name">if</span> (<span class="name">null</span>? (<span class="name">cdr</span> x))</div><div class="line">      x</div><div class="line">      (<span class="name">last-pair</span> (<span class="name">cdr</span> x))))</div></pre></td></tr></table></figure>
<h3 id="共享与相等"><a href="#共享与相等" class="headerlink" title="共享与相等"></a>共享与相等</h3><p>共享会导致多个对象都拥有同一个对象，修改一个会导致另外的也跟着被修改。<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">eq</span>? x y)<span class="comment">;检查是不是一个对象</span></div></pre></td></tr></table></figure></p>
<h3 id="改变也就是赋值"><a href="#改变也就是赋值" class="headerlink" title="改变也就是赋值"></a>改变也就是赋值</h3><p>主要是构建了一前一后两个指针。<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> (<span class="name">cons</span> x y)</div><div class="line">  (<span class="name">define</span> (<span class="name">set-x!</span> v) (<span class="name">set!</span> x v))</div><div class="line">  (<span class="name">define</span> (<span class="name">set-y!</span> v) (<span class="name">set!</span> y v))</div><div class="line">  (<span class="name">define</span> (<span class="name">dispatch</span> m)</div><div class="line">    (<span class="name">cond</span> ((<span class="name">eq</span>? m 'car) x)</div><div class="line">          ((<span class="name">eq</span>? m 'cdr) y)</div><div class="line">          ((<span class="name">eq</span>? m 'set-car!) set-x!)</div><div class="line">          ((<span class="name">eq</span>? m 'set-cdr!) set-y!)</div><div class="line">          (<span class="name">else</span> (<span class="name">error</span> <span class="string">"Undefined operation -- CONS"</span> m))))</div><div class="line">  dispatch)</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">car</span> z) (<span class="name">z</span> 'car))</div><div class="line">(<span class="name">define</span> (<span class="name">cdr</span> z) (<span class="name">z</span> 'cdr))</div><div class="line">(<span class="name">define</span> (<span class="name">set-car!</span> z new-value)</div><div class="line">  ((<span class="name">z</span> 'set-car!) new-value)</div><div class="line">  z)</div><div class="line">(<span class="name">define</span> (<span class="name">set-cdr!</span> z new-value)</div><div class="line">  ((<span class="name">z</span> 'set-cdr!) new-value)</div><div class="line">  z)</div></pre></td></tr></table></figure></p>
<h2 id="队列的表示"><a href="#队列的表示" class="headerlink" title="队列的表示"></a>队列的表示</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">;构造函数</span></div><div class="line">(<span class="name">define</span> (<span class="name">make-queue</span>) (<span class="name">cons</span> '() '()))</div><div class="line"><span class="comment">;选择函数</span></div><div class="line">(<span class="name">define</span> (<span class="name">front-queue</span> queue)</div><div class="line">  (<span class="name">if</span> (<span class="name">empty-queue</span>? queue)</div><div class="line">      (<span class="name">error</span> <span class="string">"FRONT called with an empty queue"</span> queue)</div><div class="line">      (<span class="name">car</span> (<span class="name">front-ptr</span> queue))))</div><div class="line"><span class="comment">;检测队列是否为空</span></div><div class="line">(<span class="name">define</span> (<span class="name">empty-queue</span>? queue) (<span class="name">null</span>? (<span class="name">front-ptr</span> queue)))</div><div class="line"><span class="comment">;改变函数</span></div><div class="line">(<span class="name">define</span> (<span class="name">insert-queue!</span> queue item)</div><div class="line">  (<span class="name">let</span> ((<span class="name">new-pair</span> (<span class="name">cons</span> item '())))</div><div class="line">    (<span class="name">cond</span> ((<span class="name">empty-queue</span>? queue)</div><div class="line">           (<span class="name">set-front-ptr!</span> queue new-pair)</div><div class="line">           (<span class="name">set-rear-ptr!</span> queue new-pair)</div><div class="line">           queue)</div><div class="line">          (<span class="name">else</span></div><div class="line">           (<span class="name">set-cdr!</span> (<span class="name">rear-ptr</span> queue) new-pair)</div><div class="line">           (<span class="name">set-rear-ptr!</span> queue new-pair)</div><div class="line">           queue))))</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">delete-queue!</span> queue)</div><div class="line">  (<span class="name">cond</span> ((<span class="name">empty-queue</span>? queue)</div><div class="line">         (<span class="name">error</span> <span class="string">"DELETE! called with an empty queue"</span> queue))</div><div class="line">        (<span class="name">else</span></div><div class="line">         (<span class="name">set-front-ptr!</span> queue (<span class="name">cdr</span> (<span class="name">front-ptr</span> queue)))</div><div class="line">         queue)))</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">front-ptr</span> queue) (<span class="name">car</span> queue))</div><div class="line">(<span class="name">define</span> (<span class="name">rear-ptr</span> queue) (<span class="name">cdr</span> queue))</div><div class="line">(<span class="name">define</span> (<span class="name">set-front-ptr!</span> queue item) (<span class="name">set-car!</span> queue item))</div><div class="line">(<span class="name">define</span> (<span class="name">set-rear-ptr!</span> queue item) (<span class="name">set-car!</span> queue item))</div></pre></td></tr></table></figure>
<h2 id="表格的表示"><a href="#表格的表示" class="headerlink" title="表格的表示"></a>表格的表示</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> (<span class="name">lookup</span> key table)</div><div class="line">  (<span class="name">let</span> ((<span class="name">record</span> (<span class="name">assoc</span> key (<span class="name">cdr</span> table))))</div><div class="line">    (<span class="name">if</span> record</div><div class="line">        (<span class="name">cdr</span> record)</div><div class="line">        false)))</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">assoc</span> key records)</div><div class="line">  (<span class="name">cond</span> ((<span class="name">null</span>? records) false)</div><div class="line">        ((<span class="name">equal</span>? key (<span class="name">caar</span> records)) (<span class="name">car</span> records))</div><div class="line">        (<span class="name">else</span> (<span class="name">assoc</span> key (<span class="name">cdr</span> records)))))</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">insert!</span> key value table)</div><div class="line">  (<span class="name">let</span> ((<span class="name">record</span> (<span class="name">assoc</span> key (<span class="name">cdr</span> table))))</div><div class="line">    (<span class="name">if</span> record</div><div class="line">        (<span class="name">set-cdr!</span> record value)</div><div class="line">        (<span class="name">set-cdr!</span> table</div><div class="line">                  (<span class="name">cons</span> (<span class="name">cons</span> key value) (<span class="name">cdr</span> table))))))</div><div class="line">(<span class="name">define</span> (<span class="name">make-table</span>)</div><div class="line">  (<span class="name">list</span> '*table*))</div></pre></td></tr></table></figure>
<h2 id="数字电路的模拟器"><a href="#数字电路的模拟器" class="headerlink" title="数字电路的模拟器"></a>数字电路的模拟器</h2><h1 id="并发：时间本质是个问题"><a href="#并发：时间本质是个问题" class="headerlink" title="并发：时间本质是个问题"></a>并发：时间本质是个问题</h1><p>和普通的并发问题是一致的。<br>串行化共享部分。<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> s make-serializer)</div><div class="line">(<span class="name">define</span> (<span class="name">make-account</span> balance)</div><div class="line">  (<span class="name">define</span> (<span class="name">withdraw</span> amount)</div><div class="line">    (<span class="name">if</span> (<span class="name">&gt;=</span> balance amount)</div><div class="line">        (<span class="name">begin</span> (<span class="name">set!</span> balance (<span class="name">=</span> balance amount))</div><div class="line">               balance)</div><div class="line">        <span class="string">"Insufficient funds"</span>))</div><div class="line">  (<span class="name">define</span> (<span class="name">deposit</span> amount)</div><div class="line">    (<span class="name">set!</span> balance (<span class="name">+</span> balance amount))</div><div class="line">    balance)</div><div class="line">  (<span class="name">let</span> ((<span class="name">protected</span> (<span class="name">make-serializer</span>)))</div><div class="line">    (<span class="name">define</span> (<span class="name">dispatch</span> m)</div><div class="line">      (<span class="name">cond</span> ((<span class="name">eq</span>? m 'withdraw) (<span class="name">protected</span> withdraw))</div><div class="line">            ((<span class="name">eq</span>? m 'deposit) (<span class="name">protected</span> deposit))</div><div class="line">            ((<span class="name">eq</span>? m 'balance) balance)</div><div class="line">            (<span class="name">else</span> (<span class="name">error</span> <span class="string">"Unknown request --MAKE-ACCOUNT"</span></div><div class="line">                         m))))</div><div class="line">    dispatch))</div></pre></td></tr></table></figure></p>
<h2 id="串行化的实现"><a href="#串行化的实现" class="headerlink" title="串行化的实现"></a>串行化的实现</h2><p>互斥元同步机制。<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">(<span class="name">define</span> (<span class="name">make-serializer</span>)</div><div class="line">  (<span class="name">let</span> ((<span class="name">mutex</span> (<span class="name">make-mutex</span>)))</div><div class="line">    (<span class="name">lambda</span> (<span class="name">p</span>)</div><div class="line">      (<span class="name">define</span> (<span class="name">serialized-p</span> . args)</div><div class="line">        (<span class="name">mutex</span> 'acquire)</div><div class="line">        (<span class="name">let</span> ((<span class="name">val</span> (<span class="name">apply</span> p args)))</div><div class="line">          (<span class="name">mutex</span> 'release)</div><div class="line">          val))</div><div class="line">      serialized-p)))</div><div class="line"></div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">make-mutex</span>)</div><div class="line">  (<span class="name">let</span> ((<span class="name">cell</span> (<span class="name">list</span> false)))</div><div class="line">    (<span class="name">define</span> (<span class="name">the-mutex</span> m)</div><div class="line">      (<span class="name">cond</span> ((<span class="name">eq</span>? m 'acquire)</div><div class="line">             (<span class="name">if</span> (<span class="name">test-and-set!</span> cell)</div><div class="line">                 (<span class="name">the-mutex</span> 'acquire)))</div><div class="line">            ((<span class="name">eq</span>? m 'release) (<span class="name">clea!</span> cell))))</div><div class="line">    the-mutex))</div><div class="line"></div><div class="line">(<span class="name">define</span> (<span class="name">test-and-set!</span> cell)</div><div class="line">  (<span class="name">if</span> (<span class="name">car</span> cell)</div><div class="line">      true</div><div class="line">      (<span class="name">begin</span> (<span class="name">set-car!</span> cell true)</div><div class="line">             false)))</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/child//blog/2016/09/读书笔记-sicp-第三章-模块化-对象和状态.html" data-id="civke9j01000we6kamt8jjncl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sicp/">sicp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/计算机程序的构造与解释/">计算机程序的构造与解释</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2016/10/windows下Pyqt-guiqwt环境的搭建.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          windows下Pyqt + guiqwt环境的搭建
        
      </div>
    </a>
  
  
    <a href="/blog/2016/09/读书笔记-sicp-第二章-带有通用型操作的系统.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">[读书笔记] sicp 第二章 带有通用型操作的系统</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/开发环境/">开发环境</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/摘录/">摘录</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/游戏/">游戏</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PS4/">PS4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPG/">RPG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sicp/">sicp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stl源码剖析/">stl源码剖析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂书/">杂书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂谈/">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/游戏/">游戏</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/环境搭建/">环境搭建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/理论/">理论</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程规范/">编程规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机程序的构造与解释/">计算机程序的构造与解释</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 16.67px;">C++</a> <a href="/tags/PS4/" style="font-size: 10px;">PS4</a> <a href="/tags/RPG/" style="font-size: 10px;">RPG</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/sicp/" style="font-size: 16.67px;">sicp</a> <a href="/tags/stl源码剖析/" style="font-size: 10px;">stl源码剖析</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/杂书/" style="font-size: 10px;">杂书</a> <a href="/tags/杂谈/" style="font-size: 13.33px;">杂谈</a> <a href="/tags/游戏/" style="font-size: 10px;">游戏</a> <a href="/tags/环境搭建/" style="font-size: 10px;">环境搭建</a> <a href="/tags/理论/" style="font-size: 16.67px;">理论</a> <a href="/tags/编程规范/" style="font-size: 10px;">编程规范</a> <a href="/tags/计算机程序的构造与解释/" style="font-size: 16.67px;">计算机程序的构造与解释</a> <a href="/tags/读书笔记/" style="font-size: 20px;">读书笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2016/11/读书笔记-stl源码剖析 -第一章、第二章.html">[读书笔记] stl源码剖析 第一章、第二章</a>
          </li>
        
          <li>
            <a href="/blog/2016/11/阅读谷歌编程规范.html">阅读谷歌编程规范</a>
          </li>
        
          <li>
            <a href="/blog/2016/10/windows下Pyqt-guiqwt环境的搭建.html">windows下Pyqt + guiqwt环境的搭建</a>
          </li>
        
          <li>
            <a href="/blog/2016/09/读书笔记-sicp-第三章-模块化-对象和状态.html">[读书笔记] sicp 第三章 模块化 对象和状态</a>
          </li>
        
          <li>
            <a href="/blog/2016/09/读书笔记-sicp-第二章-带有通用型操作的系统.html">[读书笔记] sicp 第二章 带有通用型操作的系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 YangYi<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>